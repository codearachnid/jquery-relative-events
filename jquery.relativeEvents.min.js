(function(e,t,n,r){function o(t,n){this.element=t;this.settings=e.extend({},s,n);this._defaults=s;this._name=i;this._debug=this.settings.debug;this.eventData={item:[],map:[],group:[]};this.init()}var i="relativeEvents",s={debug:false,eventOffset:{top:0,left:0,width:0,height:0},sortEvents:false,setStartOfDay:true,dayStart:8,dayStartOffset:0};o.prototype={init:function(){if(this._debug){console.time(this._name+"-init");console.log(this._name+".init()")}if(this.setEventData())this.setEventPositions();if(this.settings.setStartOfDay)this.setStartOfDay();if(this._debug)console.timeEnd(this._name+"-init")},setEventData:function(){if(this._debug){console.time(this._name+"-setEventData");console.log(this._name+".setEventData()")}var t=this,n=e(this.element).find(".events .event");n.each(function(r,i){i=e(i);if(typeof i.attr("id")==="undefined"){itemID="event-"+r;i.attr("id",itemID)}else{itemID=i.attr("id")}var s=parseInt(i.attr("data-hour"))*60+parseInt(i.attr("data-minute"));var o=s+parseInt(i.attr("data-duration"));t.eventData.item[itemID]={start:s,end:o,column:0};t.insertEventToMap(itemID,s,o,false);t.insertEventToGroup(itemID,s,o,false);if(r==n.length-1){if(t._debug){console.timeEnd(t._name+"-setEventData");console.log(t.eventData)}}});return true},setEventPositions:function(){if(this._debug){console.time(this._name+"-setEventPositions");console.log(this._name+".setEventPositions()")}var t=this,n=e(this.element).find(".events").width();for(var r=0;r<this.eventData.group.length;r++){itemWidth=parseInt(n)/parseInt(this.eventData.group[r].maxWidth);for(var i=0;i<this.eventData.group[r].id.length;i++){item=this.eventData.item[this.eventData.group[r].id[i]];itemOffset={};itemOffset.top=item.start+parseInt(this.settings.eventOffset.top);if(parseInt(this.eventData.group[r].maxWidth)>1&&item.column>1){itemOffset.left=itemWidth*(item.column-1)+parseInt(this.settings.eventOffset.left)}e("#"+this.eventData.group[r].id[i]).width(itemWidth+parseInt(this.settings.eventOffset.width)).height(parseInt(item.end)-parseInt(item.start)+parseInt(this.settings.eventOffset.height)).offset(itemOffset)}}if(this._debug)console.timeEnd(this._name+"-setEventPositions")},insertEventToGroup:function(e,t,n,r){if(this._debug){console.time(this._name+"-insertEventToGroup");console.log(this._name+".insertEventToGroup("+e+","+t+","+n+","+r+")")}if(this.eventData.group.length==0||this.eventData.group.length<=r){this.eventData.group[this.eventData.group.length]={id:[e],range:{start:t,end:n},maxWidth:1};r=this.eventData.group.length-1;if(this._debug)console.timeEnd(this._name+"-insertEventToGroup")}else{if(r!==false){this.eventData.group[r].id.push(e);if(this.eventData.group[r].range.end<n){this.eventData.group[r].range.end=n}if(this.eventData.group[r].maxWidth<this.eventData.item[itemID].column){this.eventData.group[r].maxWidth=this.eventData.item[itemID].column}}else{r=this.eventData.group.length;for(var i=0;i<this.eventData.group.length;i++){if(this.eventData.group[i].range.start<=t&&this.eventData.group[i].range.end>t){r=i;break}}if(this._debug)console.timeEnd(this._name+"-insertEventToGroup");this.insertEventToGroup(e,t,n,r)}}},insertEventToMap:function(e,t,n,r){if(this._debug){console.time(this._name+"-insertEventToMap");console.log(this._name+".insertEventToMap("+e+","+t+","+n+","+r+")")}if(this.eventData.map.length==0||this.eventData.map.length<=r){this.eventData.map.push(this.arrayFill(0,1440,""));r=this.eventData.map.length-1}if(r!==false){for(var i=t;i<n;i++){this.eventData.map[r][i]=e}this.eventData.item[itemID].column=r+1;if(this._debug)console.timeEnd(this._name+"-insertEventToMap")}else{var s=true;for(var i=0;i<this.eventData.map.length;i++){s=true;for(var o=t;o<n;o++){if(this.eventData.map[i][o]!=""){s=false;break}}if(s){r=i;break}else if(!s&&i==this.eventData.map.length-1){r=this.eventData.map.length}}if(this._debug)console.timeEnd(this._name+"-insertEventToMap");this.insertEventToMap(e,t,n,r)}},setStartOfDay:function(){if(this._debug){console.time(this._name+"-setStartOfDay");console.log(this._name+".setStartOfDay()")}var t=e(this.element);var n=t.find(".grid li[data-hour="+parseInt(this.settings.dayStart)+"]");if(n.length==0){console.log(this._name+".setStartOfDay() error: day start could not be found in dom");if(this._debug)console.timeEnd(this._name+"-setStartOfDay");return false}t.scrollTop(n.position().top-t.scrollTop()+parseInt(this.settings.dayStartOffset));if(this._debug)console.timeEnd(this._name+"-setStartOfDay")},arrayFill:function(e,t,n){if(this._debug){console.time(this._name+"-arrayFill");console.log(this._name+".arrayFill("+e+","+t+","+n+")")}var r={};if(!isNaN(e)&&!isNaN(t)){for(var i=0;i<t;i++){r[i+e]=n}}if(this._debug)console.timeEnd(this._name+"-arrayFill");return r}};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new o(this,t))}})}})(jQuery,window,document)
/**
 * jQuery Relative Events
 * @link https://github.com/codearachnid/jquery-relative-events/
 */
