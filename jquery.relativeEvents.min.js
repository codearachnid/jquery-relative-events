(function(e,t,n,r){function o(t,n){this.element=t;this.settings=e.extend({},s,n);this._defaults=s;this._name=i;this._debug=this.settings.debug;this.eventData=[],this.init()}var i="relativeEvents",s={debug:false,eventOffset:{top:0,left:0,width:0,height:0},sortEvents:false,setStartOfDay:true,dayStart:8,dayStartOffset:0};o.prototype={init:function(){if(this._debug){console.time(this._name+"-init");console.log(this._name+".init()")}if(this.setEventData())this.setEventPositions();if(this.settings.setStartOfDay)this.setStartOfDay();if(this._debug)console.timeEnd(this._name+"-init")},setEventData:function(){if(this._debug){console.time(this._name+"-setEventData");console.log(this._name+".setEventData()")}var t=this;e(this.element).find(".day").each(function(n,r){if(typeof e(r).id==="undefined"){var i=t.getUUID();e(r).attr("id",i)}else{var i=e(r).id}if(n==0)e(r).addClass("first");var s=e(r).find(".event");if(typeof t.eventData[i]==="undefined")t.eventData[i]={item:[],map:[],group:[]};s.each(function(n,r){r=e(r);if(typeof r.attr("id")==="undefined"){itemID="event-"+n;r.attr("id",itemID)}else{itemID=r.attr("id")}var s=parseInt(r.attr("data-hour"))*60+parseInt(r.attr("data-minute"));var o=s+parseInt(r.attr("data-duration"));t.eventData[i].item[itemID]={start:s,end:o,day:i,column:0};t.insertEventToMap(itemID,s,o,i,false);t.insertEventToGroup(itemID,s,o,i,false)});if(n==e(t.element).find(".day").length-1){if(t._debug){console.timeEnd(t._name+"-setEventData")}}});return true},setEventPositions:function(){if(this._debug){console.time(this._name+"-setEventPositions");console.log(this._name+".setEventPositions()")}var t=this;for(var n in this.eventData){columnWidth=e(this.element).find("#"+n).width();for(var r=0;r<this.eventData[n].group.length;r++){itemWidth=parseInt(columnWidth)/parseInt(this.eventData[n].group[r].maxWidth)+parseInt(this.settings.eventOffset.width);console.log(columnWidth+"/"+this.eventData[n].group[r].maxWidth+"+"+this.settings.eventOffset.width);for(var i=0;i<this.eventData[n].group[r].id.length;i++){item=this.eventData[n].item[this.eventData[n].group[r].id[i]];itemHeight=parseInt(item.end)-parseInt(item.start)+parseInt(this.settings.eventOffset.height);itemOffset={};itemOffset.top=item.start+parseInt(this.settings.eventOffset.top);if(parseInt(this.eventData[n].group[r].maxWidth)>1&&item.column>1){itemOffset.left=itemWidth*(item.column-1)+parseInt(this.settings.eventOffset.left)*(item.column-1)}e("#"+this.eventData[n].group[r].id[i],e("#"+n)).width(itemWidth).height(itemHeight).css(itemOffset);if(t._debug){console.log(this._name+".setEventPosition: column: #"+n+" item: #"+this.eventData[n].group[r].id[i]+" width:"+itemWidth+"px height:"+itemHeight+"px offset-x:"+e("#"+this.eventData[n].group[r].id[i]).offset().left+" offset-y:"+e("#"+this.eventData[n].group[r].id[i]).offset().top)}}}}if(this._debug)console.timeEnd(this._name+"-setEventPositions")},insertEventToGroup:function(e,t,n,r,i){if(this._debug){console.time(this._name+"-insertEventToGroup");console.log(this._name+".insertEventToGroup("+e+","+t+","+n+","+r+","+i+")")}if(this.eventData[r].group.length==0||this.eventData[r].group.length<=i){this.eventData[r].group[this.eventData[r].group.length]={id:[e],range:{start:t,end:n},maxWidth:1};i=this.eventData[r].group.length-1;if(this._debug)console.timeEnd(this._name+"-insertEventToGroup")}else{if(i!==false){this.eventData[r].group[i].id.push(e);if(this.eventData[r].group[i].range.end<n){this.eventData[r].group[i].range.end=n}if(this.eventData[r].group[i].maxWidth<this.eventData[r].item[itemID].column){this.eventData[r].group[i].maxWidth=this.eventData[r].item[itemID].column}}else{i=this.eventData[r].group.length;for(var s=0;s<this.eventData[r].group.length;s++){if(this.eventData[r].group[s].range.start<=t&&this.eventData[r].group[s].range.end>t){i=s;break}}if(this._debug)console.timeEnd(this._name+"-insertEventToGroup");this.insertEventToGroup(e,t,n,r,i)}}},insertEventToMap:function(e,t,n,r,i){if(this._debug){console.time(this._name+"-insertEventToMap");console.log(this._name+".insertEventToMap("+e+","+t+","+n+","+r+","+i+")")}if(this.eventData[r].map.length==0||this.eventData[r].map.length<=i){this.eventData[r].map.push(this.arrayFill(0,1440,""));i=this.eventData[r].map.length-1}if(i!==false){for(var s=t;s<n;s++){this.eventData[r].map[i][s]=e}this.eventData[r].item[itemID].column=i+1;if(this._debug)console.timeEnd(this._name+"-insertEventToMap")}else{var o=true;for(var s=0;s<this.eventData[r].map.length;s++){o=true;for(var u=t;u<n;u++){if(this.eventData[r].map[s][u]!=""){o=false;break}}if(o){i=s;break}else if(!o&&s==this.eventData[r].map.length-1){i=this.eventData[r].map.length}}if(this._debug)console.timeEnd(this._name+"-insertEventToMap");this.insertEventToMap(e,t,n,r,i)}},setStartOfDay:function(){if(this._debug){console.time(this._name+"-setStartOfDay");console.log(this._name+".setStartOfDay()")}var t=e(this.element);var n=t.find(".grid li[data-hour="+parseInt(this.settings.dayStart)+"]");if(n.length==0){console.log(this._name+".setStartOfDay() error: day start could not be found in dom");if(this._debug)console.timeEnd(this._name+"-setStartOfDay");return false}t.scrollTop(n.position().top-t.scrollTop()+parseInt(this.settings.dayStartOffset));if(this._debug)console.timeEnd(this._name+"-setStartOfDay")},arrayFill:function(e,t,n){if(this._debug){console.time(this._name+"-arrayFill");console.log(this._name+".arrayFill("+e+","+t+","+n+")")}var r={};if(!isNaN(e)&&!isNaN(t)){for(var i=0;i<t;i++){r[i+e]=n}}if(this._debug)console.timeEnd(this._name+"-arrayFill");return r},getUUID:function(){if(this._debug){console.time(this._name+"-getUUID");console.log(this._name+".getUUID()")}var e=[],t="0123456789abcdef";for(var n=0;n<36;n++){e[n]=t.substr(Math.floor(Math.random()*16),1)}e[14]="4";e[19]=t.substr(e[19]&3|8,1);e[8]=e[13]=e[18]=e[23]="-";var r=e.join("");if(this._debug)console.timeEnd(this._name+"-getUUID");return r}};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new o(this,t))}})}})(jQuery,window,document)
/**
 * jQuery Relative Events
 * @link https://github.com/codearachnid/jquery-relative-events/
 */
